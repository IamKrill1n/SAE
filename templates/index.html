<!DOCTYPE html>
<html>
<head>
    <title>SAE Visualization Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        select, input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .output {
            white-space: pre-wrap;
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
        }
        #status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .error {
            background-color: #f2dede;
            color: #a94442;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>SAE Visualization Dashboard</h1>
    <form id="modelForm">
        <div class="form-group">
            <label for="model_name">Model Name:</label>
            <select name="model_name" id="model_name" onchange="updateSaeIds()">
                <option value="gpt2-small">gpt2-small</option>
                <option value="tiny-stories-1L-21M">tiny-stories-1L-21M</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="sae_id">SAE ID:</label>
            <select name="sae_id" id="sae_id">
                <optgroup label="GPT-2 Small" id="gpt2-options">
                    {% for sae_id in gpt2_sae_ids %}
                    <option value="{{ sae_id }}">{{ sae_id }}</option>
                    {% endfor %}
                </optgroup>
                <optgroup label="Tiny Stories" id="tiny-stories-options">
                    {% for sae_id in tiny_stories_sae_ids %}
                    <option value="{{ sae_id }}">{{ sae_id }}</option>
                    {% endfor %}
                </optgroup>
            </select>
        </div>
        
        <button type="button" onclick="loadModel()">Load Model</button>
    </form>

    <div id="status" class="hidden"></div>

    <form id="promptForm" class="hidden">
        <div class="form-group">
            <label for="prompt">Prompt:</label>
            <input type="text" name="prompt" id="prompt">
        </div>
        <button type="button" onclick="analyzePrompt()">Analyze</button>
    </form>

    <div id="output" class="output hidden"></div>

    <script>
        function updateSaeIds() {
            const modelSelect = document.getElementById('model_name');
            const gpt2Options = document.getElementById('gpt2-options');
            const tinyStoriesOptions = document.getElementById('tiny-stories-options');
            
            if (modelSelect.value === 'gpt2-small') {
                gpt2Options.style.display = 'block';
                tinyStoriesOptions.style.display = 'none';
            } else {
                gpt2Options.style.display = 'none';
                tinyStoriesOptions.style.display = 'block';
            }
        }

        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = isError ? 'error' : 'success';
            status.style.display = 'block';
        }

        function loadModel() {
            const formData = new FormData(document.getElementById('modelForm'));
            
            fetch('/load_model', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showStatus(data.message);
                    document.getElementById('promptForm').classList.remove('hidden');
                } else {
                    showStatus(data.message, true);
                }
            })
            .catch(error => {
                showStatus('Error loading model: ' + error, true);
            });
        }

        function analyzePrompt() {
            const formData = new FormData(document.getElementById('promptForm'));
            
            fetch('/analyze', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    const output = document.getElementById('output');
                    output.innerHTML = data.output;
                    output.classList.remove('hidden');
                } else {
                    showStatus(data.message, true);
                }
            })
            .catch(error => {
                showStatus('Error analyzing prompt: ' + error, true);
            });
        }
        
        // Initialize on page load
        updateSaeIds();
    </script>
</body>
</html>